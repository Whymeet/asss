# Реализация отправки email заказов для калькулятора листовок

## Что было реализовано:

### 1. Модальное окно заказа
- Добавлено модальное окно в шаблон `list/template.php`
- Поля для ввода контактных данных:
  - Имя (обязательное, минимум 2 символа)
  - Телефон (обязательное, валидация российских номеров)
  - Email (необязательное, с валидацией формата)
  - Дата для звонка (необязательное, ограничение: от сегодня до года вперед)
  - Время для звонка (необязательное, рабочие часы 9:00-18:00)

### 2. Валидация данных
**Клиентская сторона (JavaScript):**
- Проверка обязательных полей
- Валидация телефона (российские номера)
- Валидация email формата
- Проверка даты (не раньше сегодня, не позже года)
- Проверка времени (рабочие часы)
- Связанная валидация даты и времени

**Серверная сторона (PHP):**
- Дублирование всех проверок клиентской стороны
- Дополнительная очистка и валидация данных

### 2. Кнопка заказа
- Добавлена кнопка "Заказать печать" в результаты расчета
- Кнопка автоматически собирает данные калькулятора

### 4. JavaScript функции
- `openOrderModal()` - открытие модального окна с автозаполнением данных заказа
- `closeOrderModal()` - закрытие модального окна
- `initializeDateTimeValidation()` - настройка валидации полей даты и времени
- `validateOrderForm()` - полная валидация формы перед отправкой
- `sendOrderEmail()` - отправка данных на сервер
- `handleOrderResponse()` - обработка ответа сервера

### 5. Серверная часть
- Добавлен метод `sendOrderAction()` в класс `PrintCalcComponent`
- Валидация обязательных полей и форматов данных
- Форматирование сообщения для email
- Отправка через событие Битрикса `CALC_ORDER_REQUEST`
- Улучшенная обработка времени (поддержка разных форматов)

## Формат сообщения для листовок (БСО):

```
=== НОВЫЙ ЗАКАЗ ИЗ КАЛЬКУЛЯТОРА ===

Информация о заказе:
Продукт: БСО
Формат бланка: A5
Печать: 1+0
Тираж: 123
Количество слоёв: 1 слой
Нумерация: Да, нужна
Одинаковые слои или разные?: Слои одинаковые
Дополнительные услуги: Биговка, Перфорация
Итого: 1962 руб.

Клиент:
Имя: Алексей
Телефон: +79178130134
E-mail: koboc777.mail@gmail.com
Удобное время для звонка: 12.02.2025 11:11

Дата заказа: 23.07.2025 14:30:15
```

## Событие Битрикс:
- Тип события: `CALC_ORDER_REQUEST`
- Поля:
  - ORDER_TEXT - полный текст заказа
  - CLIENT_NAME - имя клиента
  - CLIENT_PHONE - телефон клиента
  - CLIENT_EMAIL - email клиента
  - PRODUCT_TYPE - тип продукта (БСО)
  - TOTAL_PRICE - итоговая цена
  - ORDER_DATE - дата заказа

## Стили:
- Современный дизайн модального окна
- Анимации появления/исчезновения
- Адаптивность для мобильных устройств
- Кнопка заказа с градиентом и эффектами

## Валидация:
- Проверка обязательных полей (имя, телефон)
- Проверка корректности данных заказа
- Обработка ошибок отправки

## Совместимость:
- Работает с BX.ajax (если доступен)
- Fallback на fetch API
- Совместимо с существующей архитектурой калькулятора

## Тестирование:
- Файл `list_test.php` для тестирования функционала
- Логирование в `calc_debug.log` для отладки
